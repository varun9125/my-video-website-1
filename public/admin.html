<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<meta name="robots" content="noindex,nofollow">

<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:system-ui}
.wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.panel{width:100%;max-width:460px;background:#141414;padding:24px;border-radius:16px;box-shadow:0 0 30px rgba(255,0,85,.25)}
h2{text-align:center;margin:0 0 10px;color:#ff0055}
label{display:block;margin-top:14px;font-size:13px;color:#bbb}
input{width:100%;padding:12px;margin-top:6px;border-radius:10px;border:1px solid #222;background:#0f0f0f;color:#fff}
button{width:100%;margin-top:18px;padding:14px;border:none;border-radius:12px;background:#ff0055;color:#fff;font-weight:600;cursor:pointer}
button:disabled{opacity:.6;cursor:not-allowed}
.progress{display:none;height:8px;background:#222;margin-top:14px;border-radius:10px;overflow:hidden}
.progress div{height:100%;width:0%;background:#ff0055;transition:width .2s}
#status{margin-top:12px;font-size:14px;text-align:center;min-height:20px}
.ok{color:#0f9d58}
.err{color:#ff4444}
</style>
</head>

<body>
<div class="wrapper">
<div class="panel">

<h2>üîê Admin Upload</h2>

<label>Password</label>
<input id="password" type="password">

<label>Video Title</label>
<input id="title" type="text">

<label>Select Video</label>
<input id="video" type="file" accept="video/*">

<div class="progress" id="progress"><div id="bar"></div></div>
<button id="btn">üöÄ Upload</button>
<div id="status"></div>

</div>
</div>

<script>
/* ===== CLOUDINARY CONFIG ===== */
const CLOUD_NAME = "doeuirlh";
const UPLOAD_PRESET = "kamababa_unsigned";
const CHUNK = 20 * 1024 * 1024; // üî• 20MB (stable)

/* ===== ELEMENTS ===== */
const btn = document.getElementById("btn");
const bar = document.getElementById("bar");
const progress = document.getElementById("progress");
const status = document.getElementById("status");

btn.onclick = async () => {
 const password = passwordInput.value.trim();
 const file = videoInput.files[0];
 const title = titleInput.value.trim() || "Untitled";

 if(!password || !file){
  status.innerHTML="<span class='err'>Missing data</span>";
  return;
 }

 btn.disabled = true;
 progress.style.display = "block";
 status.innerText = "Uploading‚Ä¶";

 const total = file.size;
 let start = 0;
 let uploadUrl = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`;

 while (start < total) {
  const end = Math.min(start + CHUNK, total);
  const blob = file.slice(start, end);

  const fd = new FormData();
  fd.append("file", blob);
  fd.append("upload_preset", UPLOAD_PRESET);
  fd.append("folder", "kamababa/videos");

  await new Promise((resolve, reject) => {
   const xhr = new XMLHttpRequest();
   xhr.open("POST", uploadUrl, true);
   xhr.setRequestHeader(
     "Content-Range",
     `bytes ${start}-${end-1}/${total}`
   );

   xhr.onload = () => {
    if (xhr.status >= 200 && xhr.status < 300) {
     const res = JSON.parse(xhr.responseText || "{}");
     if (res.secure_url) uploadUrl = res.secure_url;
     resolve();
    } else reject();
   };

   xhr.onerror = reject;
   xhr.send(fd);
  });

  start = end;
  bar.style.width = Math.round((start / total) * 80) + "%";
 }

 bar.style.width = "90%";
 status.innerText = "Saving‚Ä¶";

 const save = await fetch("/api/save-video",{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  body:JSON.stringify({ password, title, url: uploadUrl })
 });

 const out = await save.json();
 if(out.success){
  bar.style.width = "100%";
  status.innerHTML="<span class='ok'>‚úÖ Upload successful</span>";
 }else{
  status.innerHTML="<span class='err'>Save failed</span>";
 }

 btn.disabled = false;
};
</script>

</body>
</html>
