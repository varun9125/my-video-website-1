<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<meta name="robots" content="noindex,nofollow">

<style>
body{
 margin:0;
 background:#0b0b0b;
 color:#fff;
 font-family:system-ui;
}
.wrapper{
 min-height:100vh;
 display:flex;
 align-items:center;
 justify-content:center;
 padding:20px;
}
.panel{
 width:100%;
 max-width:460px;
 background:#141414;
 padding:24px;
 border-radius:16px;
 box-shadow:0 0 30px rgba(255,0,85,.25);
}
h2{text-align:center;margin:0 0 10px;color:#ff0055}
label{display:block;margin-top:14px;font-size:13px;color:#bbb}
input{
 width:100%;
 padding:12px;
 margin-top:6px;
 border-radius:10px;
 border:1px solid #222;
 background:#0f0f0f;
 color:#fff;
}
button{
 width:100%;
 margin-top:18px;
 padding:14px;
 border:none;
 border-radius:12px;
 background:#ff0055;
 color:#fff;
 font-weight:600;
 cursor:pointer;
}
button:disabled{opacity:.6;cursor:not-allowed}

.thumb-preview{margin-top:10px;display:none}
.thumb-preview img{width:100%;border-radius:8px;border:2px solid #ff0055}

.progress{display:none;height:8px;background:#222;margin-top:14px;border-radius:10px;overflow:hidden}
.progress div{height:100%;width:0%;background:#ff0055;transition:width .2s}

#status{margin-top:12px;font-size:14px;text-align:center;min-height:20px}
.ok{color:#0f9d58}
.err{color:#ff4444}
</style>
</head>

<body>
<div class="wrapper">
<div class="panel">

<h2>üîê Admin Upload</h2>

<label>Password</label>
<input id="password" type="password" placeholder="Admin password">

<label>Video Title</label>
<input id="title" type="text" placeholder="SEO friendly title">

<label>Select Video</label>
<input id="video" type="file" accept="video/*">

<label>Select Thumbnail (from device gallery)</label>
<input id="thumbFile" type="file" accept="image/*">

<div class="thumb-preview" id="thumbPreview">
 <img id="thumbImg">
</div>

<div class="progress" id="progress"><div id="bar"></div></div>

<button id="btn">üöÄ Upload</button>
<div id="status"></div>

<hr style="margin:20px 0;border-color:#222">

<h3 style="text-align:center;color:#bbb">Delete Existing Videos</h3>
<div id="videoList"></div>

</div>
</div>

<script>
let selectedThumbnail=null;

const passwordInput=document.getElementById("password");
const titleInput=document.getElementById("title");
const videoInput=document.getElementById("video");
const thumbFile=document.getElementById("thumbFile");
const thumbPreview=document.getElementById("thumbPreview");
const thumbImg=document.getElementById("thumbImg");
const btn=document.getElementById("btn");
const status=document.getElementById("status");
const bar=document.getElementById("bar");
const progress=document.getElementById("progress");
const videoList=document.getElementById("videoList");

/* THUMBNAIL FROM DEVICE */
thumbFile.addEventListener("change",()=>{
 const file=thumbFile.files[0];
 if(!file) return;
 const reader=new FileReader();
 reader.onload=()=>{
  selectedThumbnail=reader.result;
  thumbImg.src=reader.result;
  thumbPreview.style.display="block";
 };
 reader.readAsDataURL(file);
});

/* UPLOAD */
btn.onclick=()=>{
 if(!passwordInput.value||!videoInput.files[0]||!selectedThumbnail){
  status.innerHTML="<span class='err'>‚ùå Missing fields</span>";return;
 }

 btn.disabled=true;
 progress.style.display="block";
 bar.style.width="5%";
 status.innerText="Uploading‚Ä¶";

 const fd=new FormData();
 fd.append("password",passwordInput.value);
 fd.append("title",titleInput.value||"Untitled");
 fd.append("video",videoInput.files[0]);
 fd.append("thumbnail",selectedThumbnail);

 fetch("/api/upload",{method:"POST",body:fd})
 .then(r=>r.json())
 .then(res=>{
  btn.disabled=false;
  progress.style.display="none";
  bar.style.width="0%";
  if(res.success){
   status.innerHTML="<span class='ok'>‚úÖ Upload successful</span>";
   loadVideos();
  }else{
   status.innerHTML="<span class='err'>‚ùå Upload failed</span>";
  }
 });
};

/* LOAD VIDEOS */
function loadVideos(){
 fetch("/api/videos")
 .then(r=>r.json())
 .then(videos=>{
  videoList.innerHTML="";
  videos.forEach(v=>{
   const row=document.createElement("div");
   row.style.cssText="display:flex;align-items:center;gap:8px;margin:6px 0";
   row.innerHTML=`
    <img src="${v.thumbnail||'/logo.png'}" style="width:60px;height:34px;object-fit:cover;border-radius:4px">
    <span style="flex:1;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${v.title}</span>
    <button style="background:#ff4444;padding:6px 10px;border-radius:6px"
     onclick="deleteVideo('${v._id}')">üóë</button>
   `;
   videoList.appendChild(row);
  });
 });
}
loadVideos();

/* DELETE */
function deleteVideo(id){
 if(!confirm("Delete this video permanently?")) return;
 fetch("/api/delete/"+id,{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  body:JSON.stringify({ password: passwordInput.value })
 })
 .then(r=>r.json())
 .then(res=>{
  if(res.success){ loadVideos(); alert("Deleted"); }
  else alert("Delete failed");
 });
}
</script>

</body>
</html>
