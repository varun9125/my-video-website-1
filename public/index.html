<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KamaBaba Viral Videos üî• | Adult Desi Viral Clips</title>
<meta name="description" content="Watch trending desi viral adult videos on KamaBaba Viral." />
<meta name="robots" content="index, follow" />
<link rel="icon" href="/favicon.ico" />
<meta name="theme-color" content="#000000" />

<style>
:root{
  --bg:#0b0b0b;
  --card:#141414;
  --accent:#ff0055;
  --soft:#888;
  --ad-bg:#0f0f10;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#fff;font-family:system-ui, -apple-system, "Segoe UI"}

#ageGate{
  position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:9999;
  display:flex;align-items:center;justify-content:center;
}
.ageBox{
  background:#141414;padding:22px;border-radius:12px;text-align:center;
  box-shadow:0 0 30px rgba(255,0,85,.14);max-width:360px;
}
.ageBtns{display:flex;gap:10px;margin-top:16px}
.ageBtns button{
  flex:1;padding:10px;border:none;border-radius:8px;font-weight:600;cursor:pointer;
}
.yes{background:#0f9d58;color:#fff}
.no{background:#333;color:#fff}

/* HEADER */
header{position:sticky;top:0;z-index:10;background:#111;padding:14px;text-align:center;border-bottom:1px solid #222}
header img{height:44px;display:block;margin:0 auto}
#search{width:100%;margin-top:10px;padding:12px;border-radius:10px;border:none;background:#1a1a1a;color:#fff}

/* GRID */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:14px;padding:14px}
.card{background:var(--card);border-radius:12px;overflow:hidden;cursor:pointer;transition:transform .12s}
.card:hover{transform:translateY(-4px)}
.thumb{aspect-ratio:16/9;background:#000}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.info{padding:9px}
.title{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.views{font-size:11px;color:var(--soft)}

/* AD SLOT (visible) */
.ad-slot{
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--ad-bg);
  color:#ddd;
  border-radius:10px;
  padding:12px;
  min-height:110px;
  text-align:center;
  font-weight:600;
  gap:8px;
}
.ad-slot .label{font-size:13px;color:#bbb}
.ad-slot a{color:#fff;text-decoration:none;padding:10px 12px;border-radius:8px;background:linear-gradient(90deg,#ff0055,#ff3380)}

/* PAGINATION */
.pagination{display:flex;justify-content:center;gap:6px;padding:16px}
.pagination button{padding:7px 12px;border:none;border-radius:8px;background:#1f1f1f;color:#fff;cursor:pointer}
.pagination button.active{background:var(--accent)}

/* FOOTER */
footer{text-align:center;padding:18px;color:#777;font-size:13px;border-top:1px solid #222}

/* responsive tweaks */
@media (max-width:420px){
  header img{height:40px}
  .ad-slot{min-height:90px;padding:10px}
}
</style>
</head>
<body>

<!-- AGE GATE -->
<div id="ageGate">
  <div class="ageBox">
    <h2>üîû Adult Content</h2>
    <p>18+ Only ‚Äî Tap to continue</p>
    <div class="ageBtns">
      <button class="yes" onclick="allow()">I am 18+</button>
      <button class="no" onclick="deny()">No</button>
    </div>
  </div>
</div>

<header>
  <img src="/logo.png" alt="KamaBaba Logo">
  <input id="search" placeholder="Search hot videos..." />
</header>

<div class="grid" id="grid"></div>

<!-- PAGINATION -->
<div class="pagination" id="pagination"></div>

<!-- ADSTERRA: keep this exact (unchanged) -->
<div style="padding:14px">
  <script async data-cfasync="false"
    src="https://pl28304315.effectivegatecpm.com/75174a0c15fdc41fe820fb9dadf17605/invoke.js"></script>
  <div id="container-75174a0c15fdc41fe820fb9dadf17605"></div>
</div>

<footer>¬© <span id="year"></span> KamaBaba Viral ‚Äî All Rights Reserved</footer>

<script>
/* ===== basic UI state ===== */
document.getElementById("year").innerText = new Date().getFullYear();
const ageGate = document.getElementById("ageGate");
const grid = document.getElementById("grid");
const pagination = document.getElementById("pagination");
const searchInput = document.getElementById("search");

if(localStorage.getItem("adult")==="yes"){
  ageGate.style.display = "none";
}
function allow(){
  localStorage.setItem("adult","yes");
  ageGate.style.display = "none";
}
function deny(){ location.href = "https://google.com"; }

/* ===== data + paging ===== */
let allVideos = [];
let page = 1;
const perPage = 12; // number of items per page (as you had)
const adEvery = 3;   // insert visible ad after every 3 video cards (changeable)

/* ===== helper: Cloudinary derived thumbnail or fallback ===== */
function autoThumb(url){
  if(!url) return "/logo.png";
  try{
    if(url.includes("/video/upload/")){
      // best-effort transformation (Cloudinary public url pattern)
      return url
        .replace("/video/upload/","/video/upload/so_2/")
        .replace(/\.(mp4|mov|webm).*/i,".jpg");
    }
  }catch(e){}
  return "/logo.png";
}

/* ===== load videos and render ===== */
function loadVideos(){
  fetch("/api/videos").then(r=>r.json()).then(vs=>{
    allVideos = Array.isArray(vs)?vs:[];
    page = 1;
    render();
  }).catch(err=>{
    console.error("Failed to load videos", err);
    allVideos = [];
    render();
  });
}

function render(){
  grid.innerHTML = "";
  pagination.innerHTML = "";

  const q = (searchInput.value || "").toLowerCase();
  const filtered = allVideos.filter(v => !q || (v.title && v.title.toLowerCase().includes(q)));

  const totalPages = Math.max(1, Math.ceil(filtered.length / perPage));
  if(page > totalPages) page = totalPages;

  const start = (page - 1) * perPage;
  const pageItems = filtered.slice(start, start + perPage);

  // build grid, inserting an ad slot after every adEvery items
  pageItems.forEach((v, idx) => {
    // actual index in page (0..)
    const globalIndex = start + idx;

    // create video card
    const thumb = v.thumbnail || autoThumb(v.url);
    const card = document.createElement("div");
    card.className = "card";
    card.onclick = () => { location.href = "/watch?id=" + v._id; };

    card.innerHTML = `
      <div class="thumb">
        <img src="${thumb}" loading="lazy" alt="${escapeHtml(v.title||'video')}" onerror="this.src='/logo.png'">
      </div>
      <div class="info">
        <div class="title">${escapeHtml(v.title||'Untitled')}</div>
        <div class="views">üëÅ ${v.views||0}</div>
      </div>`;

    grid.appendChild(card);

    // insert ad slot after every adEvery items (but not after last)
    if((idx + 1) % adEvery === 0 && (idx + 1) !== pageItems.length){
      const adSlot = document.createElement("div");
      adSlot.className = "ad-slot";
      // visible ad content ‚Äî clickable smartlink (one-time open also exists below)
      adSlot.innerHTML = `
        <div>
          <div class="label">Sponsored</div>
          <div style="margin-top:8px;">
            <a href="https://www.effectivegatecpm.com/t08q3aadri?key=17e7075568b797a5f86e95c5711c322a" target="_blank" rel="noopener">Open Offer</a>
          </div>
        </div>`;
      grid.appendChild(adSlot);
    }
  });

  // pagination buttons
  for(let i=1;i<=totalPages;i++){
    const btn = document.createElement("button");
    btn.innerText = i;
    btn.className = i===page ? "active" : "";
    btn.onclick = () => { page = i; window.scrollTo(0,0); render(); };
    pagination.appendChild(btn);
  }
}

/* utility: safely escape text for title */
function escapeHtml(s){
  if(!s) return "";
  return String(s).replace(/[&<>"']/g, function(m){
    return {"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m];
  });
}

/* ===== search handler ===== */
searchInput.addEventListener("input", ()=>{
  page = 1;
  render();
});

/* ===== one-time smartlink open (keeps ad behaviour) ===== */
let openedSmart = false;
document.addEventListener("click", ()=>{
  if(!openedSmart){
    // open the affiliate/smart link in new tab (only once)
    window.open("https://www.effectivegatecpm.com/t08q3aadri?key=17e7075568b797a5f86e95c5711c322a", "_blank");
    openedSmart = true;
  }
},{once:true});

/* ===== init ===== */
loadVideos();
</script>
</body>
</html>
