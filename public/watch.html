<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#000000">

<!-- VIDEO.JS -->
<link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>

<!-- GOOGLE IMA SDK -->
<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.11.0/dist/videojs.ima.min.js"></script>

<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui}
.topLogo{text-align:center;padding:10px;border-bottom:1px solid #222}
.topLogo img{height:36px}
.playerWrap{width:100%;aspect-ratio:16/9;background:#000}
.video-js{width:100%;height:100%}
</style>
</head>

<body>

<div class="topLogo">
 <img src="/logo.png" alt="KamaBaba Viral">
</div>

<div class="playerWrap">
 <video
   id="player"
   class="video-js vjs-default-skin"
   controls
   preload="auto"
   playsinline>
 </video>
</div>

<script>
const id = new URLSearchParams(location.search).get("id");
const player = videojs("player");

fetch("/api/videos")
.then(r => r.json())
.then(vs => {
 const video = vs.find(v => v._id === id);
 if(!video){
   alert("Video not found");
   return;
 }

 // MAIN VIDEO SOURCE
 player.src({ src: video.url, type: "video/mp4" });

 // INIT IMA (SAFE MODE)
 player.ima({
   id: "player",
   adTagUrl: "https://s.magsrv.com/v1/vast.php?zoneid=5816342",
   debug: false,
   timeout: 4000,
   prerollTimeout: 4000
 });

 // USER CLICK = PLAY
 player.one("play", function () {
   try {
     player.ima.initializeAdDisplayContainer();
     player.ima.requestAds();
   } catch (e) {
     // ignore ad failure
   }
 });

 // ðŸ”‘ HARD FAILSAFE
 player.on("adserror", function () {
   player.play();
 });

 player.on("ads-ad-ended", function () {
   player.play();
 });
});
</script>

</body>
</html>
