<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Watch Video | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/logo-192.png">
<meta name="theme-color" content="#000000">

<style>
body{
 margin:0;
 background:#000;
 color:#fff;
 font-family:system-ui,-apple-system,Segoe UI;
}

/* ===== AGE GATE ===== */
#ageGate{
 position:fixed; inset:0;
 background:rgba(0,0,0,.95);
 z-index:9999;
 display:flex;
 align-items:center;
 justify-content:center;
}
.ageBox{
 background:#141414;
 padding:24px;
 border-radius:12px;
 max-width:320px;
 text-align:center;
 box-shadow:0 0 30px #ff0055;
}
.ageBtns{display:flex;gap:10px;margin-top:18px}
.ageBtns button{
 flex:1;padding:10px;border:none;border-radius:8px;
 font-weight:600;cursor:pointer
}
.yes{background:#0f9d58;color:#fff}
.no{background:#333;color:#fff}

/* ===== LOGO ===== */
.topLogo{text-align:center;padding:8px}
.topLogo img{height:36px}

/* ===== PLAYER FIX ===== */
.playerWrap{
 position:relative;
 width:100%;
 max-width:100%;
 aspect-ratio:16/9;
 background:#000;
}
#player{
 width:100%;
 height:100%;
 object-fit:contain;
 background:#000;
}

/* ===== INFO ===== */
.info{padding:12px}
.info h3{margin:6px 0;font-size:16px}
.meta{font-size:13px;color:#aaa}

/* ===== ACTIONS ===== */
.actions{
 display:flex;
 gap:10px;
 margin-top:10px;
 flex-wrap:wrap
}
.actions button{
 padding:8px 14px;
 border:none;
 border-radius:8px;
 background:#1c1c1c;
 color:#fff;
 cursor:pointer
}
.actions button:hover{background:#ff0055}

/* ===== RELATED ===== */
#related{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
 gap:12px;
 padding:12px
}
.card{
 background:#111;
 border-radius:8px;
 overflow:hidden;
 cursor:pointer
}
.card video{
 width:100%;
 aspect-ratio:16/9;
 object-fit:cover;
 background:#000
}
.card p{
 font-size:13px;
 margin:6px;
 white-space:nowrap;
 overflow:hidden;
 text-overflow:ellipsis
}

#loader{text-align:center;padding:20px;color:#888}
</style>
</head>

<body>

<!-- AGE GATE -->
<div id="ageGate">
 <div class="ageBox">
  <h2>üîû Adult Content</h2>
  <p>18+ Only</p>
  <div class="ageBtns">
   <button class="yes" onclick="allow()">I am 18+</button>
   <button class="no" onclick="deny()">No</button>
  </div>
 </div>
</div>

<div class="topLogo">
 <img src="/logo.png" alt="KamaBaba Viral">
</div>

<!-- VIDEO PLAYER -->
<div class="playerWrap">
 <video id="player" controls playsinline preload="metadata"></video>
</div>

<div class="info">
 <h3 id="title">Loading‚Ä¶</h3>
 <div class="meta">
  üëÅ <span id="viewCount">0</span>
  &nbsp; üëç <span id="likeCount">0</span>
 </div>

 <div class="actions">
  <button onclick="like()">üëç Like</button>
  <button onclick="share()">üîó Share</button>
 </div>
</div>

<!-- ADSTERRA -->
<div style="padding:12px">
<script async data-cfasync="false"
src="https://pl28304315.effectivegatecpm.com/75174a0c15fdc41fe820fb9dadf17605/invoke.js"></script>
<div id="container-75174a0c15fdc41fe820fb9dadf17605"></div>
</div>

<h3 style="padding-left:12px">Related Videos</h3>
<div id="loader">Loading‚Ä¶</div>
<div id="related"></div>

<script>
if(localStorage.adult==="yes") ageGate.style.display="none";
function allow(){localStorage.adult="yes";ageGate.style.display="none"}
function deny(){location.href="https://google.com"}

const id=new URLSearchParams(location.search).get("id");
const player=document.getElementById("player");
const titleEl=document.getElementById("title");
const viewCount=document.getElementById("viewCount");
const likeCount=document.getElementById("likeCount");
const related=document.getElementById("related");
const loader=document.getElementById("loader");

let allVideos=[];

fetch("/api/videos")
.then(r=>r.json())
.then(vs=>{
 allVideos=vs||[];
 const v=allVideos.find(x=>x._id===id);
 if(!v){titleEl.innerText="Video not found";return}

 player.src=v.url;
 titleEl.innerText=v.title;
 viewCount.innerText=v.views||0;
 likeCount.innerText=v.likes||0;

 if(!sessionStorage["v_"+id]){
  fetch("/api/view/"+id,{method:"POST"});
  viewCount.innerText++;
  sessionStorage["v_"+id]=1;
 }

 renderRelated();
});

function renderRelated(){
 loader.style.display="none";
 related.innerHTML="";

 allVideos
 .filter(v=>v._id!==id)
 .slice(0,8)
 .forEach(v=>{
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
   <video src="${v.url}#t=1" muted preload="metadata"></video>
   <p>${v.title}</p>`;
  c.onclick=()=>location.href="/watch?id="+v._id;
  related.appendChild(c);
 });
}

function like(){
 if(sessionStorage["l_"+id])return;
 fetch("/api/like/"+id,{method:"POST"});
 likeCount.innerText++;
 sessionStorage["l_"+id]=1;
}

function share(){
 navigator.clipboard.writeText(location.href);
 alert("Link copied");
}

/* SMARTLINK */
let opened=false;
document.addEventListener("click",()=>{
 if(!opened){
  window.open("https://www.effectivegatecpm.com/t08q3aadri?key=17e7075568b797a5f86e95c5711c322a","_blank");
  opened=true;
 }
},{once:true});
</script>

</body>
</html>
