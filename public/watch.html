<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<title>Watch</title>
<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui}
video{width:100%;max-height:300px}
.box{padding:10px}
button{margin-right:6px;padding:6px 10px}
.comment{background:#111;padding:6px;margin-top:5px;border-radius:5px}
</style>
</head>
<body>

<video id="player" controls></video>

<div class="box">
<h3 id="title"></h3>
<p id="views"></p>

<button onclick="like()">ğŸ‘</button>
<button onclick="dislike()">ğŸ‘</button>

<h4>Comments</h4>
<input id="cmt"><button onclick="comment()">Post</button>
<div id="comments"></div>
</div>

<script>
const id=new URLSearchParams(location.search).get("id");

fetch("/api/view/"+id,{method:"POST"});

fetch("/api/videos").then(r=>r.json()).then(vs=>{
  const v=vs.find(x=>x.id==id);
  if(!v)return;
  player.src=v.url;
  title.innerText=v.title;
  views.innerText="ğŸ‘ "+v.views;
  v.comments.forEach(c=>{
    const d=document.createElement("div");
    d.className="comment";d.innerText=c;
    comments.appendChild(d);
  });
});

function like(){fetch("/api/like/"+id,{method:"POST"}).then(()=>location.reload())}
function dislike(){fetch("/api/dislike/"+id,{method:"POST"}).then(()=>location.reload())}

function comment(){
  const t=cmt.value;
  if(!t)return;
  fetch("/api/comment/"+id,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({text:t})
  }).then(()=>location.reload());
}
</script>
</body>
</html>
