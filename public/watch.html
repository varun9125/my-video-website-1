<script>
const params = new URLSearchParams(location.search);
const currentId = params.get("id");

let allVideos = [];

// ðŸ”¹ Fetch all videos
fetch("/api/videos")
  .then(res => res.json())
  .then(videos => {
    allVideos = videos;

    // ðŸ”¹ Current video
    const current = videos.find(v => v._id === currentId);

    if (!current) return;

    // ðŸ”¹ Load player
    const player = document.getElementById("player");
    if (player) {
      player.src = current.url;
    }

    // ðŸ”¹ Related videos (exclude current)
    const related = videos.filter(v => v._id !== currentId);

    showRelated(related);
  });

function showRelated(videos){
  const box = document.getElementById("related");
  box.innerHTML = "";

  videos.slice(0, 8).forEach(v => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <video class="thumb"
        src="${v.url}#t=1"
        muted
        preload="metadata">
      </video>
      <p>${v.title}</p>
    `;

    card.onclick = () => {
      location.href = "/watch?id=" + v._id;
    };

    box.appendChild(card);
  });
}
</script>
