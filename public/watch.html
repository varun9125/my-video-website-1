<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#000000">

<!-- VIDEO.JS -->
<link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>

<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui}

/* AGE NOTICE (NON BLOCKING) */
#ageNotice{
 background:#111;
 padding:10px;
 text-align:center;
 font-size:13px;
 border-bottom:1px solid #222;
}
#ageNotice button{
 margin-left:10px;
 padding:4px 10px;
 border:none;
 border-radius:6px;
 background:#ff0055;
 color:#fff;
 cursor:pointer;
}

/* HEADER */
.topLogo{text-align:center;padding:10px;border-bottom:1px solid #222}
.topLogo img{height:36px}

/* PLAYER */
.playerWrap{width:100%;aspect-ratio:16/9;background:#000}
.video-js{width:100%;height:100%}

/* INFO */
.info{padding:12px}
.meta{font-size:13px;color:#aaa}
.actions{display:flex;gap:10px;margin-top:10px}
.actions button{
 padding:8px 14px;
 border:none;
 border-radius:8px;
 background:#1c1c1c;
 color:#fff;
 cursor:pointer
}

/* RELATED */
#related{
 display:grid;
 grid-template-columns:repeat(2,1fr);
 gap:12px;
 padding:12px
}
.card{
 background:#111;
 border-radius:8px;
 overflow:hidden;
 cursor:pointer
}
.card img{
 width:100%;
 aspect-ratio:16/9;
 object-fit:cover;
 display:block
}
.card p{
 font-size:13px;
 margin:6px;
 white-space:nowrap;
 overflow:hidden;
 text-overflow:ellipsis
}

/* FOOTER */
footer{
 max-width:720px;
 margin:30px auto;
 padding:14px;
 text-align:center;
 font-size:13px;
 color:#aaa;
 border-top:1px solid #222;
}
footer a{color:#aaa;margin:0 6px;text-decoration:none}
footer a:hover{color:#fff}
</style>
</head>

<body>

<div id="ageNotice">
 This website contains adult content. 18+ only.
 <button onclick="this.parentElement.remove()">I am 18+</button>
</div>

<div class="topLogo">
 <img src="/logo.png" alt="KamaBaba Viral">
</div>

<div class="playerWrap">
 <video id="player" class="video-js vjs-default-skin" controls playsinline preload="auto"></video>
</div>

<div class="info">
 <h3 id="title">Loading‚Ä¶</h3>
 <div class="meta">
  üëÅ <span id="viewCount">0</span> ¬∑ üëç <span id="likeCount">0</span>
 </div>
 <div class="actions">
  <button onclick="like()">üëç Like</button>
  <button onclick="share()">üîó Share</button>
 </div>
</div>

<h3 style="padding-left:12px">Related Videos</h3>
<div id="related"></div>

<footer>
 ¬© 2025 KamaBaba Viral  
 <br><br>
 <a href="/privacy-policy">Privacy Policy</a> |
 <a href="/terms">Terms</a> |
 <a href="/dmca">DMCA</a> |
 <a href="/contact">Contact</a>
</footer>

<script>
const id=new URLSearchParams(location.search).get("id");
const titleEl=document.getElementById("title");
const viewCount=document.getElementById("viewCount");
const likeCount=document.getElementById("likeCount");
const related=document.getElementById("related");

let allVideos=[];
const player=videojs("player");

function getThumb(v){
 if(v.thumbnail && v.thumbnail.trim()!=="") return v.thumbnail;
 if(!v.url || !v.url.includes("/video/upload/")) return "/logo.png";
 return v.url
  .replace("/video/upload/","/video/upload/so_2/")
  .replace(/\.(mp4|webm|mov).*/i,".jpg");
}

fetch("/api/videos")
.then(r=>r.json())
.then(vs=>{
 allVideos=Array.isArray(vs)?vs:[];
 const v=allVideos.find(x=>x._id===id);
 if(!v) return;

 titleEl.innerText=v.title;
 viewCount.innerText=v.views||0;
 likeCount.innerText=v.likes||0;
 player.src({src:v.url,type:"video/mp4"});

 if(!sessionStorage["v_"+id]){
  fetch("/api/view/"+id,{method:"POST"});
  viewCount.innerText++;
  sessionStorage["v_"+id]=1;
 }
 renderRelated();
});

function renderRelated(){
 related.innerHTML="";
 allVideos.filter(v=>v._id!==id).slice(0,10).forEach(v=>{
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`<img src="${getThumb(v)}"><p>${v.title}</p>`;
  c.onclick=()=>location.href="/watch?id="+v._id;
  related.appendChild(c);
 });
}

function like(){
 if(sessionStorage["l_"+id])return;
 fetch("/api/like/"+id,{method:"POST"});
 likeCount.innerText++;
 sessionStorage["l_"+id]=1;
}
function share(){
 navigator.clipboard.writeText(location.href);
 alert("Link copied");
}
</script>

</body>
</html>
