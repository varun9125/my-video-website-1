<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Watch Video | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#000000">

<!-- EXOCLICK CLIENT HINTS -->
<meta http-equiv="Delegate-CH"
content="Sec-CH-UA https://s.magsrv.com;
Sec-CH-UA-Mobile https://s.magsrv.com;
Sec-CH-UA-Platform https://s.magsrv.com;">

<!-- VIDEO.JS -->
<link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>

<!-- GOOGLE IMA (EXOCLICK INSTREAM) -->
<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.11.0/dist/videojs.ima.min.js"></script>

<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui}
.playerWrap{width:100%;aspect-ratio:16/9;background:#000}
.video-js{width:100%;height:100%}
.info{padding:12px}
</style>
</head>

<body>

<div class="playerWrap">
  <video
    id="player"
    class="video-js vjs-default-skin"
    controls
    playsinline
    preload="auto">
  </video>
</div>

<div class="info">
  <h3 id="title">Loadingâ€¦</h3>
</div>

<script>
/* ================= LOAD VIDEO ================= */
const id = new URLSearchParams(location.search).get("id");
const titleEl = document.getElementById("title");

fetch("/api/videos")
.then(r=>r.json())
.then(list=>{
  const v = list.find(x=>x._id===id || x.id==id);
  if(!v){
    titleEl.innerText="Video not found";
    return;
  }

  titleEl.innerText = v.title || "Video";

  const player = videojs("player");

  /* SET VIDEO FIRST (VERY IMPORTANT) */
  player.src({
    src: v.url,
    type: "video/mp4"
  });

  /* ================= EXOCLICK IN-STREAM ================= */
  player.ima({
    id: "player",
    adTagUrl: "https://s.magsrv.com/v1/vast.php?idzone=236643", // TEST ZONE
    prerollTimeout: 5000,
    timeout: 5000
  });

  /* REQUEST ADS AFTER VIDEO IS READY */
  player.ready(()=>{
    try{
      player.ima.initializeAdDisplayContainer();
      player.ima.requestAds();
    }catch(e){}
  });

  /* FAILSAFE */
  player.on("adserror",()=>player.play());
});
</script>

</body>
</html>
