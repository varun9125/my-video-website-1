<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video | KamaBaba</title>

<style>
:root{
 --bg:#000;
 --card:#111;
 --accent:#ff0055;
 --soft:#999;
}

body{
 margin:0;
 background:var(--bg);
 color:#fff;
 font-family:system-ui,-apple-system,Segoe UI;
}

/* ===== PLAYER ===== */
#player{
 width:100%;
 max-height:60vh;
 background:#000;
}

/* ===== INFO ===== */
.info{
 padding:12px;
}

.info h3{
 margin:6px 0;
 font-size:16px;
 line-height:1.3;
}

/* ===== META ===== */
.meta{
 font-size:13px;
 color:var(--soft);
 margin-top:4px;
}

/* ===== ACTIONS ===== */
.actions{
 display:flex;
 gap:10px;
 margin-top:10px;
 flex-wrap:wrap;
}

.actions button{
 padding:8px 14px;
 border:none;
 border-radius:8px;
 background:#1c1c1c;
 color:#fff;
 cursor:pointer;
 font-size:14px;
 transition:.2s;
}

.actions button:hover{
 background:var(--accent);
}

/* ===== RELATED ===== */
#related{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
 gap:12px;
 padding:12px;
}

.card{
 cursor:pointer;
 background:var(--card);
 border-radius:8px;
 overflow:hidden;
 transition:.2s;
}

.card:hover{
 transform:translateY(-3px);
}

.card video{
 width:100%;
 aspect-ratio:16/9;
 object-fit:cover;
 background:#000;
}

.card p{
 font-size:13px;
 margin:6px;
 white-space:nowrap;
 overflow:hidden;
 text-overflow:ellipsis;
}

/* ===== LOADER ===== */
#loader{
 padding:20px;
 text-align:center;
 color:#aaa;
}

/* ===== MOBILE ===== */
@media(max-width:480px){
 .actions button{flex:1}
}
</style>
</head>

<body>

<!-- VIDEO -->
<video id="player" controls playsinline></video>

<!-- INFO -->
<div class="info">
  <h3 id="title">Loading...</h3>
  <div class="meta">
    üëÅ <span id="viewCount">0</span>
    &nbsp; üëç <span id="likeCount">0</span>
    &nbsp; üëé <span id="dislikeCount">0</span>
  </div>

  <div class="actions">
    <button onclick="like()">üëç Like</button>
    <button onclick="dislike()">üëé Dislike</button>
    <button onclick="share()">üîó Share</button>
  </div>
</div>

<!-- üî• ADSTERRA -->
<div style="padding:12px">
<script async data-cfasync="false"
src="https://pl28304315.effectivegatecpm.com/75174a0c15fdc41fe820fb9dadf17605/invoke.js"></script>
<div id="container-75174a0c15fdc41fe820fb9dadf17605"></div>
</div>

<h3 style="padding-left:12px">Related Videos</h3>
<div id="loader">Loading related videos...</div>
<div id="related"></div>

<script>
const id = new URLSearchParams(location.search).get("id");

const player = document.getElementById("player");
const titleEl = document.getElementById("title");
const likeCount = document.getElementById("likeCount");
const dislikeCount = document.getElementById("dislikeCount");
const viewCount = document.getElementById("viewCount");
const relatedBox = document.getElementById("related");
const loader = document.getElementById("loader");

let currentVideo = null;
let allVideos = [];

/* ===== LOAD DATA ===== */
fetch("/api/videos")
.then(r=>r.json())
.then(videos=>{
 allVideos = videos;
 currentVideo = videos.find(v => v._id === id);

 if(!currentVideo){
   titleEl.innerText = "‚ùå Video not found";
   return;
 }

 player.src = currentVideo.url;
 titleEl.innerText = currentVideo.title;

 likeCount.innerText = currentVideo.likes || 0;
 dislikeCount.innerText = currentVideo.dislikes || 0;
 viewCount.innerText = currentVideo.views || 0;

 fetch("/api/view/"+id,{method:"POST"})
   .then(()=> viewCount.innerText = Number(viewCount.innerText)+1);

 renderRelated();
});

/* ===== RELATED ===== */
function renderRelated(){
 loader.style.display="none";
 relatedBox.innerHTML="";

 allVideos
 .filter(v=>v._id!==id)
 .slice(0,8)
 .forEach(v=>{
   const c=document.createElement("div");
   c.className="card";
   c.innerHTML=`
     <video src="${v.url}#t=1" muted preload="metadata"></video>
     <p>${v.title}</p>
   `;

   const vid=c.querySelector("video");
   c.onmouseenter=()=>vid.play();
   c.onmouseleave=()=>{vid.pause();vid.currentTime=1};

   c.onclick=()=>location.href="/watch?id="+v._id;
   relatedBox.appendChild(c);
 });
}

/* ===== ACTIONS ===== */
function like(){
 fetch("/api/like/"+id,{method:"POST"});
 likeCount.innerText = Number(likeCount.innerText)+1;
}

function dislike(){
 fetch("/api/dislike/"+id,{method:"POST"});
 dislikeCount.innerText = Number(dislikeCount.innerText)+1;
}

function share(){
 if(navigator.share){
   navigator.share({
     title:document.title,
     url:location.href
   });
 }else{
   navigator.clipboard.writeText(location.href);
   alert("üîó Link copied");
 }
}

/* ===== AD DIRECT LINK (1 TIME SAFE) ===== */
const adLink="https://www.effectivegatecpm.com/t08q3aadri?key=17e7075568b797a5f86e95c5711c322a";
let adOnce=false;

document.addEventListener("click",()=>{
 if(!adOnce){
   window.open(adLink,"_blank");
   adOnce=true;
 }
});
</script>

</body>
</html>
