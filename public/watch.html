<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Watch Video</title>

<style>
body{
  margin:0;
  background:#0d0d0d;
  color:#fff;
  font-family:system-ui;
}

.container{
  max-width:900px;
  margin:auto;
  padding:10px;
}

video{
  width:100%;
  border-radius:10px;
  background:#000;
}

.actions{
  display:flex;
  gap:10px;
  margin:10px 0;
}

.actions button{
  flex:1;
  padding:10px;
  background:#222;
  border:none;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
}

.count{
  font-size:13px;
  opacity:.8;
  text-align:center;
  margin-top:4px;
}

.related{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:12px;
  margin-top:15px;
}

.related video{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">
  <video id="player" controls autoplay></video>

  <div class="actions">
    <button onclick="like()">ğŸ‘ Like</button>
    <button onclick="dislike()">ğŸ‘ Dislike</button>
  </div>

  <div class="count">
    ğŸ‘ <span id="likeCount">0</span> |
    ğŸ‘ <span id="dislikeCount">0</span> |
    ğŸ‘ <span id="viewCount">0</span>
  </div>

  <h3>Related Videos</h3>
  <div class="related" id="related"></div>
</div>

<script>
const id = new URLSearchParams(location.search).get("id");

const player = document.getElementById("player");
const likeCount = document.getElementById("likeCount");
const dislikeCount = document.getElementById("dislikeCount");
const viewCount = document.getElementById("viewCount");

/* FETCH VIDEO DATA */
fetch("/api/videos")
.then(r=>r.json())
.then(videos=>{
  const current = videos.find(v=>v._id===id);
  if(!current){
    document.body.innerHTML="âŒ Video not found";
    return;
  }

  player.src = current.url;
  likeCount.innerText = current.likes;
  dislikeCount.innerText = current.dislikes;
  viewCount.innerText = current.views;

  // increase view (once)
  fetch("/api/view/"+id,{method:"POST"});

  // related videos
  const related = videos.filter(v=>v._id!==id).slice(0,8);
  const box = document.getElementById("related");

  related.forEach(v=>{
    const vid = document.createElement("video");
    vid.src = v.url+"#t=1";
    vid.muted = true;
    vid.onclick = ()=>location.href="/watch.html?id="+v._id;
    box.appendChild(vid);
  });
});

/* LIKE */
function like(){
  fetch("/api/like/"+id,{method:"POST"})
  .then(()=>refreshCounts());
}

/* DISLIKE */
function dislike(){
  fetch("/api/dislike/"+id,{method:"POST"})
  .then(()=>refreshCounts());
}

/* REFRESH COUNTS */
function refreshCounts(){
  fetch("/api/videos")
  .then(r=>r.json())
  .then(videos=>{
    const v = videos.find(v=>v._id===id);
    if(!v) return;
    likeCount.innerText = v.likes;
    dislikeCount.innerText = v.dislikes;
    viewCount.innerText = v.views;
  });
}
</script>

</body>
</html>

  document.getElementById("player").src = currentVideo.url;
  document.getElementById("title").innerText = currentVideo.title;

  fetch("/api/view/"+id,{method:"POST"});

  renderRelated();
});

function renderRelated(){
  const box = document.getElementById("related");
  box.innerHTML="";

  allVideos
  .filter(v=>v._id!==id)
  .slice(0,8)
  .forEach(v=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <video class="thumb" src="${v.url}#t=1" muted preload="metadata"></video>
      <p>${v.title}</p>
    `;
    d.onclick=()=>location.href="/watch?id="+v._id;
    box.appendChild(d);
  });
}

/* ACTIONS */
function like(){
  fetch("/api/like/"+id,{method:"POST"});
  alert("ğŸ‘ Liked");
}
function dislike(){
  fetch("/api/dislike/"+id,{method:"POST"});
  alert("ğŸ‘ Disliked");
}
function share(){
  navigator.clipboard.writeText(location.href);
  alert("ğŸ”— Link copied");
}
</script>

</body>
</html>
