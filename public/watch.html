<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video | KamaBaba</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:system-ui,Arial;
}

header{
  background:#111;
  padding:12px;
  text-align:center;
  font-size:18px;
  font-weight:600;
}

.container{
  max-width:900px;
  margin:auto;
  padding:12px;
}

/* VIDEO */
video{
  width:100%;
  max-height:60vh;
  background:#000;
  border-radius:8px;
}

/* TITLE */
h2{
  font-size:16px;
  margin:10px 0;
}

/* LIKE DISLIKE */
.actions{
  display:flex;
  gap:15px;
  margin-bottom:15px;
}

.actions button{
  background:#222;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}

/* RELATED */
.related h3{
  margin:15px 0 10px;
  font-size:15px;
}

.related-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:10px;
}

.card{
  cursor:pointer;
}

.card video{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
  border-radius:6px;
}

.card p{
  font-size:12px;
  margin:5px 0 0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
</style>
</head>

<body>

<header>ğŸ”¥ KamaBaba Viral Videos ğŸ”¥</header>

<div class="container">

  <video id="player" controls autoplay></video>

  <h2 id="title">Loading...</h2>

  <div class="actions">
    <button onclick="like()">ğŸ‘ Like <span id="likeCount">0</span></button>
    <button onclick="dislike()">ğŸ‘ Dislike <span id="dislikeCount">0</span></button>
  </div>

  <div class="related">
    <h3>Related Videos</h3>
    <div class="related-grid" id="related"></div>
  </div>

</div>

<script>
const id = new URLSearchParams(location.search).get("id");
const player = document.getElementById("player");
const titleEl = document.getElementById("title");
const relatedBox = document.getElementById("related");

// LIKE / DISLIKE (PERSISTENT)
let likes = Number(localStorage.getItem("like_"+id)) || 0;
let dislikes = Number(localStorage.getItem("dislike_"+id)) || 0;

document.getElementById("likeCount").innerText = likes;
document.getElementById("dislikeCount").innerText = dislikes;

function like(){
  likes++;
  localStorage.setItem("like_"+id,likes);
  document.getElementById("likeCount").innerText = likes;
}

function dislike(){
  dislikes++;
  localStorage.setItem("dislike_"+id,dislikes);
  document.getElementById("dislikeCount").innerText = dislikes;
}

// FETCH VIDEOS
fetch("/api/videos")
.then(res=>res.json())
.then(videos=>{
  const current = videos.find(v=>v._id===id);
  if(!current){
    titleEl.innerText="Video not found";
    return;
  }

  player.src = current.url;
  titleEl.innerText = current.title;

  // RELATED VIDEOS (simple)
  videos
    .filter(v=>v._id!==id)
    .slice(0,6)
    .forEach(v=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <video src="${v.url}#t=1" muted></video>
        <p>${v.title}</p>
      `;
      div.onclick=()=>location.href="/watch?id="+v._id;
      relatedBox.appendChild(div);
    });
});
</script>

</body>
</html>
  .then(videos=>{
    const v = videos.find(v=>v._id===id);
    if(!v) return;
    likeCount.innerText = v.likes;
    dislikeCount.innerText = v.dislikes;
    viewCount.innerText = v.views;
  });
}
</script>

</body>
</html>

  document.getElementById("player").src = currentVideo.url;
  document.getElementById("title").innerText = currentVideo.title;

  fetch("/api/view/"+id,{method:"POST"});

  renderRelated();
});

function renderRelated(){
  const box = document.getElementById("related");
  box.innerHTML="";

  allVideos
  .filter(v=>v._id!==id)
  .slice(0,8)
  .forEach(v=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <video class="thumb" src="${v.url}#t=1" muted preload="metadata"></video>
      <p>${v.title}</p>
    `;
    d.onclick=()=>location.href="/watch?id="+v._id;
    box.appendChild(d);
  });
}

/* ACTIONS */
function like(){
  fetch("/api/like/"+id,{method:"POST"});
  alert("ğŸ‘ Liked");
}
function dislike(){
  fetch("/api/dislike/"+id,{method:"POST"});
  alert("ğŸ‘ Disliked");
}
function share(){
  navigator.clipboard.writeText(location.href);
  alert("ğŸ”— Link copied");
}
</script>

</body>
</html>
