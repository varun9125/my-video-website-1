<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#000000">

<!-- VIDEO.JS -->
<link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>

<!-- GOOGLE IMA SDK -->
<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>

<!-- VIDEOJS IMA -->
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.11.0/dist/videojs.ima.min.js"></script>

<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui}
#ageGate{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:9999;display:flex;align-items:center;justify-content:center}
.ageBox{background:#141414;padding:24px;border-radius:12px;max-width:320px;text-align:center}
.ageBtns{display:flex;gap:10px;margin-top:18px}
.ageBtns button{flex:1;padding:10px;border:none;border-radius:8px;font-weight:600}
.yes{background:#0f9d58;color:#fff}.no{background:#333;color:#fff}

.topLogo{text-align:center;padding:8px}
.topLogo img{height:36px}

.playerWrap{width:100%;aspect-ratio:16/9;background:#000}
.video-js{width:100%;height:100%}

.info{padding:12px}
.meta{font-size:13px;color:#aaa}

.actions{display:flex;gap:10px;margin-top:10px}
.actions button{padding:8px 14px;border:none;border-radius:8px;background:#1c1c1c;color:#fff}

#related{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;padding:12px}
.card{background:#111;border-radius:8px;overflow:hidden;cursor:pointer}
.card video{width:100%;aspect-ratio:16/9;object-fit:cover}
.card p{font-size:13px;margin:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

#loader{text-align:center;padding:20px;color:#888}
</style>
</head>

<body>

<!-- AGE GATE -->
<div id="ageGate">
 <div class="ageBox">
  <h2>üîû Adult Content</h2>
  <p>18+ Only</p>
  <div class="ageBtns">
   <button class="yes" onclick="allow()">I am 18+</button>
   <button class="no" onclick="deny()">No</button>
  </div>
 </div>
</div>

<div class="topLogo">
 <img src="/logo.png">
</div>

<div class="playerWrap">
 <video
   id="player"
   class="video-js vjs-default-skin"
   controls
   playsinline
   preload="metadata">
 </video>
</div>

<div class="info">
 <h3 id="title">Loading‚Ä¶</h3>
 <div class="meta">üëÅ <span id="viewCount">0</span> üëç <span id="likeCount">0</span></div>
 <div class="actions">
  <button onclick="like()">üëç Like</button>
  <button onclick="share()">üîó Share</button>
 </div>
</div>

<!-- ‚úÖ ADSTERRA BANNER / NATIVE -->
<div style="padding:12px">
<script async data-cfasync="false"
 src="https://pl28304315.effectivegatecpm.com/75174a0c15fdc41fe820fb9dadf17605/invoke.js"></script>
<div id="container-75174a0c15fdc41fe820fb9dadf17605"></div>
</div>

<h3 style="padding-left:12px">Related Videos</h3>
<div id="loader">Loading‚Ä¶</div>
<div id="related"></div>

<script>
/* AGE GATE */
if(localStorage.adult==="yes") ageGate.style.display="none";
function allow(){localStorage.adult="yes";ageGate.style.display="none"}
function deny(){location.href="https://google.com"}

const id=new URLSearchParams(location.search).get("id");
const titleEl=document.getElementById("title");
const viewCount=document.getElementById("viewCount");
const likeCount=document.getElementById("likeCount");
const related=document.getElementById("related");
const loader=document.getElementById("loader");

let allVideos=[];
let player=videojs("player");

/* LOAD DATA */
fetch("/api/videos")
.then(r=>r.json())
.then(vs=>{
 allVideos = Array.isArray(vs) ? vs : [];
 const v = allVideos.find(x=>x._id===id);

 if(!v){
  titleEl.innerText="Video not found";
  loader.style.display="none";
  return;
 }

 titleEl.innerText=v.title;
 viewCount.innerText=v.views||0;
 likeCount.innerText=v.likes||0;

 player.src({src:v.url,type:"video/mp4"});

 /* EXOCLICK VAST (SAFE) */
 try{
  player.ima({
   adTagUrl:"https://s.magsrv.com/v1/vast.php?idzone=5809070",
   timeout:8000
  });
  player.one("play",()=>{
   try{
    player.ima.initializeAdDisplayContainer();
    player.ima.requestAds();
   }catch(e){}
  });
 }catch(e){}

 if(!sessionStorage["v_"+id]){
  fetch("/api/view/"+id,{method:"POST"});
  viewCount.innerText++;
  sessionStorage["v_"+id]=1;
 }

 renderRelated();
})
.catch(()=>{ loader.style.display="none"; });

function renderRelated(){
 loader.style.display="none";
 related.innerHTML="";
 allVideos.filter(v=>v._id!==id).slice(0,8).forEach(v=>{
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
   <video src="${v.url}#t=1" muted preload="metadata"></video>
   <p>${v.title}</p>`;
  c.onclick=()=>location.href="/watch?id="+v._id;
  related.appendChild(c);
 });
}

function like(){
 if(sessionStorage["l_"+id])return;
 fetch("/api/like/"+id,{method:"POST"});
 likeCount.innerText++;
 sessionStorage["l_"+id]=1;
}

function share(){
 navigator.clipboard.writeText(location.href);
 alert("Link copied");
}

/* ‚úÖ ADSTERRA SMARTLINK (ONE-TIME SAFE) */
let opened=false;
document.addEventListener("click",()=>{
 if(!opened){
  window.open(
   "https://www.effectivegatecpm.com/t08q3aadri?key=17e7075568b797a5f86e95c5711c322a",
   "_blank"
  );
  opened=true;
 }
},{once:true});
</script>

</body>
</html>
