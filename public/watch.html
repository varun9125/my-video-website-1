<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video | KamaBaba</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:system-ui, Arial;
}

/* VIDEO PLAYER */
#player{
  width:100%;
  max-height:60vh;
  background:#000;
}

/* INFO */
.info{
  padding:12px;
}

.info h3{
  margin:6px 0;
  font-size:16px;
}

/* ACTIONS */
.actions{
  margin-top:8px;
}
.actions button{
  margin-right:8px;
  padding:6px 12px;
  border:none;
  border-radius:6px;
  background:#222;
  color:#fff;
  cursor:pointer;
}

/* RELATED */
#related{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:10px;
  padding:10px;
}

.card{
  cursor:pointer;
}

.card video{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
  border-radius:6px;
}

.card p{
  font-size:13px;
  margin:4px 0 0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
</style>
</head>

<body>

<!-- VIDEO -->
<video id="player" controls playsinline></video>

<!-- INFO -->
<div class="info">
  <h3 id="title">Loading...</h3>

  ğŸ‘ <span id="likeCount">0</span>
  ğŸ‘ <span id="dislikeCount">0</span>
  ğŸ‘ï¸ <span id="viewCount">0</span>

  <div class="actions">
    <button onclick="like()">ğŸ‘ Like</button>
    <button onclick="dislike()">ğŸ‘ Dislike</button>
    <button onclick="share()">ğŸ”— Share</button>
  </div>
</div>

<!-- ğŸ”¥ ADSTERRA NATIVE BANNER -->
<div style="padding:12px">
<script async data-cfasync="false"
src="https://pl28304315.effectivegatecpm.com/75174a0c15fdc41fe820fb9dadf17605/invoke.js"></script>
<div id="container-75174a0c15fdc41fe820fb9dadf17605"></div>
</div>

<h3 style="padding-left:10px">Related Videos</h3>
<div id="related"></div>

<script>
/* =========================
   WATCH PAGE LOGIC
========================= */

const id = new URLSearchParams(location.search).get("id");

const player = document.getElementById("player");
const titleEl = document.getElementById("title");
const likeCount = document.getElementById("likeCount");
const dislikeCount = document.getElementById("dislikeCount");
const viewCount = document.getElementById("viewCount");
const relatedBox = document.getElementById("related");

let allVideos = [];
let currentVideo = null;

/* FETCH VIDEOS */
fetch("/api/videos")
.then(res => res.json())
.then(videos => {
  allVideos = videos;
  currentVideo = videos.find(v => v._id === id);

  if(!currentVideo){
    titleEl.innerText = "Video not found";
    return;
  }

  /* MAIN VIDEO */
  player.src = currentVideo.url;
  titleEl.innerText = currentVideo.title;

  likeCount.innerText = currentVideo.likes || 0;
  dislikeCount.innerText = currentVideo.dislikes || 0;
  viewCount.innerText = currentVideo.views || 0;

  /* VIEW COUNT */
  fetch("/api/view/" + id, { method:"POST" });

  renderRelated();
});

/* RELATED VIDEOS */
function renderRelated(){
  relatedBox.innerHTML = "";

  allVideos
  .filter(v => v._id !== id)
  .slice(0,8)
  .forEach(v => {
    const d = document.createElement("div");
    d.className = "card";
    d.innerHTML = `
      <video src="${v.url}#t=1" muted preload="metadata"></video>
      <p>${v.title}</p>
    `;
    d.onclick = () => location.href = "/watch?id=" + v._id;
    relatedBox.appendChild(d);
  });
}

/* ACTIONS */
function like(){
  fetch("/api/like/" + id, { method:"POST" });
  likeCount.innerText = Number(likeCount.innerText) + 1;
}

function dislike(){
  fetch("/api/dislike/" + id, { method:"POST" });
  dislikeCount.innerText = Number(dislikeCount.innerText) + 1;
}

function share(){
  navigator.clipboard.writeText(location.href);
  alert("ğŸ”— Link copied");
}

/* ğŸ”¥ ADSTERRA DIRECT LINK (SAFE â€“ 1 TIME) */
const adLink = "https://www.effectivegatecpm.com/t08q3aadri?key=17e7075568b797a5f86e95c5711c322a";
let adOpened = false;

document.addEventListener("click", () => {
  if(!adOpened){
    window.open(adLink, "_blank");
    adOpened = true;
  }
});
</script>

</body>
</html>
