<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video | KamaBaba Viral</title>

<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#000000">

<!-- VIDEO.JS -->
<link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>

<!-- GOOGLE IMA SDK -->
<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.11.0/dist/videojs.ima.min.js"></script>

<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui}
.topLogo{text-align:center;padding:10px;border-bottom:1px solid #222}
.playerWrap{width:100%;aspect-ratio:16/9;background:#000;position:relative}
.video-js{width:100%;height:100%}
#playOverlay{
 position:absolute;inset:0;display:flex;
 align-items:center;justify-content:center;
 background:rgba(0,0,0,.5);z-index:10;
 cursor:pointer;font-size:22px;font-weight:700
}
</style>
</head>

<body>

<div class="topLogo">
 <img src="/logo.png" height="36">
</div>

<div class="playerWrap">
 <div id="playOverlay">â–¶ Play Video</div>
 <video id="player" class="video-js vjs-default-skin" preload="auto" playsinline></video>
</div>

<script>
const id=new URLSearchParams(location.search).get("id");
const player=videojs("player");
const overlay=document.getElementById("playOverlay");

fetch("/api/videos").then(r=>r.json()).then(vs=>{
 const video=vs.find(v=>v._id===id);
 if(!video){alert("Video not found");return;}

 player.src({src:video.url,type:"video/mp4"});

 // INIT IMA ONCE
 player.ima({
  id:'player',
  adTagUrl:'https://s.magsrv.com/v1/vast.php?zoneid=5816342',
  timeout:5000,
  prerollTimeout:5000
 });

 overlay.onclick=()=>{
  overlay.style.display="none";

  // IMPORTANT: user click ke exact moment par
  player.ima.initializeAdDisplayContainer();
  player.ima.requestAds();
 };

 player.on('adserror',()=>{
  player.play();
 });

 player.on('ads-ad-ended',()=>{
  player.play();
 });
});
</script>

</body>
</html>
