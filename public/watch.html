<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Video</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:system-ui;
}

video{
  width:100%;
  max-height:60vh;
  background:#000;
}

.info{ padding:10px; }

.actions button{
  margin-right:10px;
  padding:6px 10px;
  border:none;
  border-radius:6px;
  background:#222;
  color:#fff;
}

#related{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:10px;
  padding:10px;
}

.card video{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
  border-radius:6px;
}
</style>
</head>

<body>

<video id="player" controls playsinline></video>

<div class="info">
  <h3 id="title"></h3>
  ğŸ‘ <span id="likeCount">0</span>
  ğŸ‘ <span id="dislikeCount">0</span>
  ğŸ‘ï¸ <span id="viewCount">0</span>

  <div class="actions">
    <button onclick="like()">ğŸ‘ Like</button>
    <button onclick="dislike()">ğŸ‘ Dislike</button>
    <button onclick="share()">ğŸ”— Share</button>
  </div>
</div>

<!-- ğŸ”¥ ADSTERRA HIGH EARNING SPOT -->
<div style="padding:10px">
<script async data-cfasync="false"
src="https://pl28304315.effectivegatecpm.com/75174a0c15fdc41fe820fb9dadf17605/invoke.js"></script>
<div id="container-75174a0c15fdc41fe820fb9dadf17605"></div>
</div>

<h3 style="padding-left:10px">Related Videos</h3>
<div id="related"></div>

<script>
const id=new URLSearchParams(location.search).get("id");
let allVideos=[], currentVideo;

fetch("/api/videos")
.then(r=>r.json())
.then(videos=>{
  allVideos=videos;
  currentVideo=videos.find(v=>v._id===id);
  if(!currentVideo) return;

  player.src=currentVideo.url;
  title.innerText=currentVideo.title;
  likeCount.innerText=currentVideo.likes;
  dislikeCount.innerText=currentVideo.dislikes;
  viewCount.innerText=currentVideo.views;

  fetch("/api/view/"+id,{method:"POST"});
  renderRelated();
});

function renderRelated(){
  const box=document.getElementById("related");
  box.innerHTML="";
  allVideos.filter(v=>v._id!==id).slice(0,8).forEach(v=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`<video src="${v.url}#t=1" muted></video><p>${v.title}</p>`;
    d.onclick=()=>location.href="/watch?id="+v._id;
    box.appendChild(d);
  });
}

function like(){
  fetch("/api/like/"+id,{method:"POST"})
  likeCount.innerText=Number(likeCount.innerText)+1;
}
function dislike(){
  fetch("/api/dislike/"+id,{method:"POST"})
  dislikeCount.innerText=Number(dislikeCount.innerText)+1;
}
function share(){
  navigator.clipboard.writeText(location.href);
  alert("Link copied");
}
</script>

</body>
</html>
  const current = videos.find(v=>v._id===id);
  if(!current){
    titleEl.innerText="Video not found";
    return;
  }

  player.src = current.url;
  titleEl.innerText = current.title;

  // RELATED VIDEOS (simple)
  videos
    .filter(v=>v._id!==id)
    .slice(0,6)
    .forEach(v=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <video src="${v.url}#t=1" muted></video>
        <p>${v.title}</p>
      `;
      div.onclick=()=>location.href="/watch?id="+v._id;
      relatedBox.appendChild(div);
    });
});
</script>

</body>
</html>
  .then(videos=>{
    const v = videos.find(v=>v._id===id);
    if(!v) return;
    likeCount.innerText = v.likes;
    dislikeCount.innerText = v.dislikes;
    viewCount.innerText = v.views;
  });
}
</script>

</body>
</html>

  document.getElementById("player").src = currentVideo.url;
  document.getElementById("title").innerText = currentVideo.title;

  fetch("/api/view/"+id,{method:"POST"});

  renderRelated();
});

function renderRelated(){
  const box = document.getElementById("related");
  box.innerHTML="";

  allVideos
  .filter(v=>v._id!==id)
  .slice(0,8)
  .forEach(v=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <video class="thumb" src="${v.url}#t=1" muted preload="metadata"></video>
      <p>${v.title}</p>
    `;
    d.onclick=()=>location.href="/watch?id="+v._id;
    box.appendChild(d);
  });
}

/* ACTIONS */
function like(){
  fetch("/api/like/"+id,{method:"POST"});
  alert("ğŸ‘ Liked");
}
function dislike(){
  fetch("/api/dislike/"+id,{method:"POST"});
  alert("ğŸ‘ Disliked");
}
function share(){
  navigator.clipboard.writeText(location.href);
  alert("ğŸ”— Link copied");
}
</script>

</body>
</html>
