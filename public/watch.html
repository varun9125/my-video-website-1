<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Watch | KamaBaba Viral</title>
<link rel="icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/logo-192.png">

<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui}
video{width:100%;max-height:60vh}
.info{padding:12px}
.actions button{padding:8px 14px;border:none;border-radius:8px;background:#222;color:#fff}
#related{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;padding:12px}
.card{cursor:pointer}
.card video{width:100%;aspect-ratio:16/9;object-fit:cover}
</style>
</head>

<body>

<video id="player" controls></video>

<div class="info">
 <h3 id="title"></h3>
 üëÅ <span id="views">0</span>
 <div class="actions">
  <button onclick="like()">üëç Like</button>
  <button onclick="history.back()">‚¨Ö Back</button>
 </div>
</div>

<h3 style="padding-left:12px">Related</h3>
<div id="related"></div>

<script>
const p=new URLSearchParams(location.search);
const id=p.get("id");

fetch("/api/videos").then(r=>r.json()).then(videos=>{
 let v=videos.find(x=>x._id===id);
 player.src=v.url; title.innerText=v.title;
 views.innerText=v.views||0;

 fetch("/api/view/"+id,{method:"POST"});

 videos.filter(x=>x._id!==id).slice(0,8).forEach(r=>{
  let c=document.createElement("div");
  c.className="card";
  c.innerHTML=`<video src="${r.url}#t=1" muted></video><p>${r.title}</p>`;
  c.onclick=()=>location.href=`/watch?id=${r._id}&page=${p.get("page")||1}`;
  related.appendChild(c);
 });
});

function like(){fetch("/api/like/"+id,{method:"POST"});}
</script>
</body>
</html>
